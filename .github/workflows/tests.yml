name: Tests

on:
  - push

jobs:
  test:
    runs-on: ubuntu-20.04

    strategy:
      matrix:
        python-version: ['3.7', '3.8', '3.9', '3.10']

    steps:
    - uses: actions/checkout@v2
    - name: Set up python ${{ matrix.python-version }}
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install .[test]
        echo ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true | sudo debconf-set-selections
        sudo apt install msttcorefonts -qq
        rm ~/.cache/matplotlib -rf
    - name: Lint with flake8
      run: |
        flake8 src
    - name: Plot tests
      run: |
        python -m pytest tests -s

  # test36:
  #   runs-on: ubuntu-18.04

  #   steps:
  #   - uses: actions/checkout@v2
  #   - name: Set up python 3.6
  #     uses: actions/setup-python@v2
  #     with:
  #       python-version: 3.6
  #   - name: Install dependencies
  #     run: |
  #       sudo apt-get install -y ffmpeg libsm6 libxext6
  #       sudo apt-get install -y python3-pip
  #       python3 -m pip install --upgrade pip
  #       pip3 install .[test36]
  #       echo ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true | sudo debconf-set-selections
  #       sudo apt install msttcorefonts -qq
  #       rm ~/.cache/matplotlib -rf
  #   - name: Plot tests
  #     run: |
  #       python -m pytest tests -s